-# " cache "topic-#{@topic.id}-messages-page#{params[:page]}-#{current_user.try(:role, @topic.forum_id)||'anon'}-#{@topic.updated_at}" do
- if true

  - content_for :title, raw(@topic.name)
  = auto_discovery_link_tag(:rss, :format => 'rss')

  - if @topic.messages.page.num_pages == [params[:page].to_i, 1].max
    = subscribe_to "/topics/#{@topic.id}"
    :javascript
      $(document).ready(function() {
        $notifications = $('#faye-notifications');
        PrivatePub.subscribe('/topics/#{@topic.id}', function(data) {
          $.get('/messages/' + data.id, function(data) {
            $(data).hide().insertAfter($('table.messages:first tr:last')).show('slow');
          });
        });
      });

  %h1
    = t('.title', name: @topic.name)
    %small= link_to t('common.edit'), edit_topic_path(@topic) if can? :update, @topic

  = render 'breadcrumb', topic: @topic, buttons: true

  = render 'messages/list'

  = render 'breadcrumb', topic: @topic, buttons: true

  = render 'messages/form', back: false if can? :create, @message
